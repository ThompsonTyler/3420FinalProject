#include "Extra.h"

int tracker = 0; //Current position in array
int len; //Length of strength (in chars)

uint8_t output[20][8][8];//Array to represent the up to 20 character output string


//Represents the characters, typeface pulled from http://www.urbanfonts.com/fonts/Arcade.htm
uint8_t chars[37][8][8] = {{{7,7,7,7,7,7,7,7}, //A
							{7,7,0,0,0,7,7,7},
							{7,0,0,7,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,0,0,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7}, //B
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //C
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //D
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //E
							{0,0,0,0,0,0,0,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7}, //F
							{0,0,0,0,0,0,0,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //G
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,0,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //H
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,0,0,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7}, //I
							{0,0,0,0,0,0,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{0,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //J
							{7,7,0,0,0,0,0,7},
							{7,7,7,7,0,0,7,7},
							{7,7,7,7,0,0,7,7},
							{7,7,7,7,0,0,7,7},
							{7,7,7,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{7,0,0,0,0,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //K
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,0,0,7,7},
							{0,0,7,0,0,7,7,7},
							{0,0,0,0,7,7,7,7},
							{0,0,0,0,0,7,7,7},
							{0,0,7,0,0,0,7,7},
							{0,0,7,7,7,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7}, //L
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7}, //M
							{0,7,7,7,7,7,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,7,0,0,0,7},
							{0,0,0,0,0,0,0,7},
							{0,0,7,0,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7}, //N
							{0,0,7,7,7,0,0,7},
							{0,0,0,7,7,0,0,7},
							{0,0,0,0,7,0,0,7},
							{0,0,7,0,0,0,0,7},
							{0,0,7,7,0,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7}, //O
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //P
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //Q
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,0,0,0,0,7},
							{0,0,7,7,0,0,7,7},
							{7,0,0,0,7,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7}, //R
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,0,0,0,7,7},
							{0,0,0,0,7,7,7,7},
							{0,0,7,0,0,7,7,7},
							{0,0,7,7,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //S
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,7,7,7},
							{7,0,0,0,0,0,7,7},
							{7,7,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //T
							{0,0,0,0,0,0,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //U
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //V
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,7,0,0,7,7},
							{7,7,0,0,0,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //W
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,0,7,0,0,7},
							{0,0,0,0,0,0,0,7},
							{7,0,0,7,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //X
							{0,0,7,7,7,0,0,7},
							{7,0,0,7,0,0,7,7},
							{7,7,0,0,0,7,7,7},
							{7,7,0,0,0,7,7,7},
							{7,0,0,7,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,7,7,7,7,7,0,7}},
							
						   {{7,7,7,7,7,7,7,7}, //Y
							{0,0,7,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{7,0,0,0,0,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //Z
							{0,0,0,0,0,0,0,7},
							{7,7,7,7,0,0,7,7},
							{7,7,7,0,0,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,0,0,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7}, //'Space'
							{7,7,7,7,7,7,7,7},
							{7,7,7,7,7,7,7,7},
							{7,7,7,7,7,7,7,7},
							{7,7,7,7,7,7,7,7},
							{7,7,7,7,7,7,7,7},
							{7,7,7,7,7,7,7,7},
							{7,7,7,7,7,7,7,7}},
							 
							{{7,7,7,7,7,7,7,7}, //0
							{7,0,0,0,0,7,7,7},
							{0,0,7,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{7,0,0,0,0,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //1
							{7,7,0,0,7,7,7,7},
							{7,0,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{0,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //2
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{7,7,7,7,0,0,7,7},
							{7,7,0,0,0,7,7,7},
							{7,0,0,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7}, //3
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{7,7,7,7,7,0,0,7},
							{7,7,7,0,0,0,7,7},
							{7,7,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //4
							{7,7,7,0,0,0,7,7},
							{7,7,0,0,0,0,7,7},
							{7,0,0,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{0,0,0,0,0,0,0,7},
							{7,7,7,7,0,0,7,7},
							{7,7,7,7,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //5
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,7,7},
							{7,7,7,7,7,0,0,7},
							{7,7,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //6
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //7
							{0,0,0,0,0,0,0,7},
							{7,7,7,7,0,0,7,7},
							{7,7,7,0,0,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7}, //8
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						  {{7,7,7,7,7,7,7,7}, //9
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,0,7},
							{7,7,7,7,7,0,0,7},
							{7,7,7,7,0,0,7,7},
							{7,7,0,0,0,7,7,7}}};
							
int lookup(int ch){ //Returns the array value corresponding to the character int value given
	if(ch == 32){ //Space
		return 26;
	}
	else if(ch >= 65){ //A-Z
		return ch - 65;
	}
	else{
		return (ch - 48) + 27; //0-9
	}
}

void buildChar(int i, char ch){ //Builds the output array based on index i with character ch
	int charConnector;
	uint8_t lineIndex;
	uint8_t rowIndex;
	
	charConnector = lookup((int)ch);
	for(lineIndex = 0; lineIndex < 8; lineIndex++){
		for(rowIndex = 0; rowIndex < 8; rowIndex++){
			output[i][rowIndex][lineIndex] = chars[charConnector][rowIndex][lineIndex];
		}
	}
}

void buildScroller(char *str){ //Takes input string and sets tracker to 0(front). len to length of string. and builds the output array
	int i;
	tracker = 0;
	len = strlen(str);
	
	for(i = 0; i < len; i++){ //Characters in string
		buildChar(i, str[i]);
	}
	
	for(i = len; i < 20; i++){ //Spaces to fill up remainder
		buildChar(i, ' ');
	}
}

int scroll(int colorize, int color){ //Scrolls 1 step, colorizing as necessary.
	uint8_t lineIndex;
	uint8_t rowIndex;
	
	for(lineIndex = 0; lineIndex < 8; lineIndex++){ //Fills backdrop based on tracker position
		for(rowIndex = 0; rowIndex < 8; rowIndex++){
			backdrop[rowIndex][lineIndex] = output[(tracker + lineIndex)/8][rowIndex][mod(tracker + lineIndex, 8)];
		}
	}
	if(colorize == 1){ //Colorizes as needed
		if(color >= 0 && color < 7){
			for(lineIndex = 0; lineIndex < 8; lineIndex++){
				for(rowIndex = 0; rowIndex < 8; rowIndex++){
					if(backdrop[rowIndex][lineIndex] == 0){
						backdrop[rowIndex][lineIndex] = color; //Set to color 
					}
				}
			}
		}
		else{ //If no color, choose a random color
			color = mod(rand(), 7);
			for(lineIndex = 0; lineIndex < 8; lineIndex++){
				for(rowIndex = 0; rowIndex < 8; rowIndex++){
					if(backdrop[rowIndex][lineIndex] == 0){
						backdrop[rowIndex][lineIndex] = color;
					}
				}
			}
		}
	}
	swapScreens(); 
	delay(7000);
	
	if (tracker == len * 8){ //Termination
		return 0;
	}
	else{ //Done with this step, increment tracker to next step.
		tracker++;
		return 1;
	}
}
