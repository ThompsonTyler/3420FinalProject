#include "Extra.h"

int tracker = 0;
int len;

uint8_t output[20][8][8];

uint8_t chars[37][8][8] = {{{7,7,7,7,7,7,7,7},
							{7,7,0,0,0,7,7,7},
							{7,0,0,7,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,0,0,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,0,0,0,0,0,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,0,0,0,0,0,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,0,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,0,0,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,0,0,0,0,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{0,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{7,7,0,0,0,0,0,7},
							{7,7,7,7,0,0,7,7},
							{7,7,7,7,0,0,7,7},
							{7,7,7,7,0,0,7,7},
							{7,7,7,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{7,0,0,0,0,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,0,0,7,7},
							{0,0,7,0,0,7,7,7},
							{0,0,0,0,7,7,7,7},
							{0,0,0,0,0,7,7,7},
							{0,0,7,0,0,0,7,7},
							{0,0,7,7,7,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,7,7,7,7,7,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,7,0,0,0,7},
							{0,0,0,0,0,0,0,7},
							{0,0,7,0,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,7,7,0,0,7},
							{0,0,0,0,7,0,0,7},
							{0,0,7,0,0,0,0,7},
							{0,0,7,7,0,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,7,7,7,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,0,0,0,0,7},
							{0,0,7,7,0,0,7,7},
							{7,0,0,0,7,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,0,0,0,0,7,7},
							{0,0,0,0,7,7,7,7},
							{0,0,7,0,0,7,7,7},
							{0,0,7,7,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,7,7,7},
							{7,0,0,0,0,0,7,7},
							{7,7,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,0,0,0,0,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,7,0,0,7,7},
							{7,7,0,0,0,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,0,7,0,0,7},
							{0,0,0,0,0,0,0,7},
							{7,0,0,7,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,7,0,0,7,7},
							{7,7,0,0,0,7,7,7},
							{7,7,0,0,0,7,7,7},
							{7,0,0,7,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,7,7,7,7,7,0,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,7,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{7,0,0,0,0,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,0,0,0,0,0,7},
							{7,7,7,7,0,0,7,7},
							{7,7,7,0,0,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,0,0,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{7,7,7,7,7,7,7,7},
							{7,7,7,7,7,7,7,7},
							{7,7,7,7,7,7,7,7},
							{7,7,7,7,7,7,7,7},
							{7,7,7,7,7,7,7,7},
							{7,7,7,7,7,7,7,7},
							{7,7,7,7,7,7,7,7}},
							 
							{{7,7,7,7,7,7,7,7},
							{7,0,0,0,0,7,7,7},
							{0,0,7,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{7,0,0,0,0,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,0,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{0,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{7,7,7,7,0,0,7,7},
							{7,7,0,0,0,7,7,7},
							{7,0,0,7,7,7,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,0,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{7,7,7,7,7,0,0,7},
							{7,7,7,0,0,0,7,7},
							{7,7,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{7,7,7,0,0,0,7,7},
							{7,7,0,0,0,0,7,7},
							{7,0,0,7,0,0,7,7},
							{0,0,7,7,0,0,7,7},
							{0,0,0,0,0,0,0,7},
							{7,7,7,7,0,0,7,7},
							{7,7,7,7,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,7,7},
							{7,7,7,7,7,0,0,7},
							{7,7,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,7,7,7},
							{0,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{0,0,0,0,0,0,0,7},
							{7,7,7,7,0,0,7,7},
							{7,7,7,0,0,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7},
							{7,7,0,0,7,7,7,7}},
							
						   {{7,7,7,7,7,7,7,7},
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,7,7}},
							
						  {{7,7,7,7,7,7,7,7},
							{7,0,0,0,0,0,7,7},
							{0,0,7,7,7,0,0,7},
							{0,0,7,7,7,0,0,7},
							{7,0,0,0,0,0,0,7},
							{7,7,7,7,7,0,0,7},
							{7,7,7,7,0,0,7,7},
							{7,7,0,0,0,7,7,7}}};
							

uint8_t Scene[12][8][8] = {{{0,7,7,7,7,7,7,7}, //Clear animation- Cyan/white scroller
													 {4,0,7,7,7,7,7,7},
													 {4,0,7,7,7,7,7,7},
													 {4,0,7,7,7,7,7,7},
													 {4,0,7,7,7,7,7,7},
													 {4,0,7,7,7,7,7,7},
												 	 {4,0,7,7,7,7,7,7},
													 {0,7,7,7,7,7,7,7}},

													{{7,7,7,7,7,7,7,7},
													 {0,0,7,7,7,7,7,7},
													 {4,4,0,7,7,7,7,7},
													 {4,4,4,0,7,7,7,7},
													 {4,4,4,0,7,7,7,7},
													 {4,4,0,7,7,7,7,7},
													 {0,0,7,7,7,7,7,7},
													 {7,7,7,7,7,7,7,7}},
										
													{{7,7,7,7,7,7,7,7},
													 {7,7,7,7,7,7,7,7},
													 {0,0,0,0,7,7,7,7},
													 {4,4,4,4,0,7,7,7},
													 {4,4,4,4,0,7,7,7},
                    			 {0,0,0,0,7,7,7,7},
                    			 {7,7,7,7,7,7,7,7},
                    			 {7,7,7,7,7,7,7,7}},
										
													{{7,7,7,7,7,7,7,7},
                    			 {7,7,7,7,7,7,7,7},
                    			 {7,7,0,0,0,0,7,7},
                    			 {7,0,4,4,4,4,0,7},
                    			 {7,0,4,4,4,4,0,7},
                   			   {7,7,0,0,0,0,7,7},
                    			 {7,7,7,7,7,7,7,7},
                    			 {7,7,7,7,7,7,7,7}},
										
													{{7,7,7,7,7,7,7,7},
                    			 {7,7,7,7,7,7,7,7},
                    			 {7,7,7,7,0,0,0,0},
                    			 {7,7,7,0,4,4,4,4},
                    			 {7,7,7,0,4,4,4,4},
                    			 {7,7,7,7,0,0,0,0},
                    			 {7,7,7,7,7,7,7,7},
                    			 {7,7,7,7,7,7,7,7}},
										
													{{7,7,7,7,7,7,7,7},
                    			 {7,7,7,7,7,7,0,0},
                    			 {7,7,7,7,7,0,4,4},
                    			 {7,7,7,7,0,4,4,4},
                    			 {7,7,7,7,0,4,4,4},
                    			 {7,7,7,7,7,0,4,4},
                    			 {7,7,7,7,7,7,0,0},
                    			 {7,7,7,7,7,7,7,7}},
										
													{{7,7,7,7,7,7,7,0},
                    			 {7,7,7,7,7,7,0,4},
                    			 {7,7,7,7,7,7,0,4},
                    			 {7,7,7,7,7,7,0,4},
                    			 {7,7,7,7,7,7,0,4},
                    			 {7,7,7,7,7,7,0,4},
                    			 {7,7,7,7,7,7,0,4},
                    			 {7,7,7,7,7,7,7,0}},
										
													{{7,7,7,7,7,7,7,7},
                    			 {7,7,7,7,7,7,0,0},
                    			 {7,7,7,7,7,0,4,4},
                    			 {7,7,7,7,0,4,4,4},
                    			 {7,7,7,7,0,4,4,4},
                    			 {7,7,7,7,7,0,4,4},
                    			 {7,7,7,7,7,7,0,0},
                    			 {7,7,7,7,7,7,7,7}},
										
													{{7,7,7,7,7,7,7,7},
                    			 {7,7,7,7,7,7,7,7},
                    			 {7,7,7,7,0,0,0,0},
                    			 {7,7,7,0,4,4,4,4},
                    			 {7,7,7,0,4,4,4,4},
                    			 {7,7,7,7,0,0,0,0},
                    			 {7,7,7,7,7,7,7,7},
                    			 {7,7,7,7,7,7,7,7}},
										
													{{7,7,7,7,7,7,7,7},
                    			 {7,7,7,7,7,7,7,7},
                    			 {7,7,0,0,0,0,7,7},
                    			 {7,0,4,4,4,4,0,7},
                    			 {7,0,4,4,4,4,0,7},
                    			 {7,7,0,0,0,0,7,7},
                    			 {7,7,7,7,7,7,7,7},
                    			 {7,7,7,7,7,7,7,7}},
										
													{{7,7,7,7,7,7,7,7},
                    			 {7,7,7,7,7,7,7,7},
                    			 {0,0,0,0,7,7,7,7},
                    			 {4,4,4,4,0,7,7,7},
                    			 {4,4,4,4,0,7,7,7},
                    			 {0,0,0,0,7,7,7,7},
                    			 {7,7,7,7,7,7,7,7},
                    			 {7,7,7,7,7,7,7,7}},
										
													{{7,7,7,7,7,7,7,7},
                    			 {0,0,7,7,7,7,7,7},
                    			 {4,4,0,7,7,7,7,7},
                    			 {4,4,4,0,7,7,7,7},
                    			 {4,4,4,0,7,7,7,7},
                    			 {4,4,0,7,7,7,7,7},
                    			 {0,0,7,7,7,7,7,7},
                    			 {7,7,7,7,7,7,7,7}}};

void updateSheet(int state, uint8_t color){ //Iterates through animation held in Scene with state being the animation frame and color being the background color
	uint8_t lineIndex;
  uint8_t rowIndex;

  for(lineIndex = 0; lineIndex < 8; lineIndex++)
  {
    for(rowIndex = 0; rowIndex < 8; rowIndex++)
    {	
			if (Scene[state][rowIndex][lineIndex] == 7){
				backdrop[rowIndex][lineIndex] = color;
			}
			else{
				backdrop[rowIndex][lineIndex] = Scene[state][rowIndex][lineIndex];
			}
    }
  }
}	

void rainbowTest(void) //Writes a rainbow to backdrop
{  
  uint8_t lineIndex;

  for(lineIndex = 0; lineIndex < 8; lineIndex++)
  {
    backdrop[lineIndex][0] = 0;
    backdrop[lineIndex][1] = 1;
    backdrop[lineIndex][2] = 2;
    backdrop[lineIndex][3] = 3;
    backdrop[lineIndex][4] = 4;
    backdrop[lineIndex][5] = 5;
    backdrop[lineIndex][6] = 6;
    backdrop[lineIndex][7] = 7;
  }
}

int lookup(int ch){
	if(ch == 32){
		return 26;
	}
	else if(ch >= 65){
		return ch - 65;
	}
	else{
		return (ch - 48) + 27;
	}
}

void buildChar(int i, char ch){
	int charConnector;
	uint8_t lineIndex;
	uint8_t rowIndex;
	
	charConnector = lookup((int)ch);
	for(lineIndex = 0; lineIndex < 8; lineIndex++){
		for(rowIndex = 0; rowIndex < 8; rowIndex++){
			output[i][rowIndex][lineIndex] = chars[charConnector][rowIndex][lineIndex];
		}
	}
}

void buildScroller(char *str){
	int i;
	tracker = 0;
	len = strlen(str);
	
	for(i = 0; i < len; i++){
		buildChar(i, str[i]);
	}
	
	for(i = len; i < 20; i++){
		buildChar(i, ' ');
	}
}

int scroll(int colorize, int color){
	uint8_t lineIndex;
	uint8_t rowIndex;
	
	for(lineIndex = 0; lineIndex < 8; lineIndex++){
		for(rowIndex = 0; rowIndex < 8; rowIndex++){
			backdrop[rowIndex][lineIndex] = output[(tracker + lineIndex)/8][rowIndex][mod(tracker + lineIndex, 8)];
		}
	}
	if(colorize == 1){
		if(color >= 0 && color < 7){
			for(lineIndex = 0; lineIndex < 8; lineIndex++){
				for(rowIndex = 0; rowIndex < 8; rowIndex++){
					if(backdrop[rowIndex][lineIndex] == 0){
						backdrop[rowIndex][lineIndex] = color;
					}
				}
			}
		}
		else{
			color = mod(rand(), 7);
			for(lineIndex = 0; lineIndex < 8; lineIndex++){
				for(rowIndex = 0; rowIndex < 8; rowIndex++){
					if(backdrop[rowIndex][lineIndex] == 0){
						backdrop[rowIndex][lineIndex] = color;
					}
				}
			}
		}
	}
	swapScreens();
	delay(7000);
	
	if (tracker == len * 8){
		return 0;
	}
	else{
		tracker++;
		return 1;
	}
}
